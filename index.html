<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CV - Hu·ª≥nh Th·ªã Kim H√¢n</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <main class="page">
      <div class="cv" id="cvRoot">
        <!-- HEADER -->
        <header class="header">
          <div class="avatar-wrap">
            <img
              id="avatarImg"
              class="avatar"
              src="avatar.jpg"
              alt="·∫¢nh ƒë·∫°i di·ªán"
            />
          </div>

          <div class="header-info">
            <h1 id="cvName" class="name">Hu·ª≥nh Th·ªã Kim H√¢n</h1>
            <p id="cvHeadline" class="headline">
              ·ª®ng tuy·ªÉn v·ªã tr√≠ nh√¢n vi√™n Telesale, Nh√¢n vi√™n vƒÉn ph√≤ng
            </p>
            <ul id="cvMeta" class="meta"></ul>
          </div>
        </header>

        <!-- H·ªåC V·∫§N -->
        <section class="section">
          <div class="section-head">
            <h2 class="section-title">H·ªåC V·∫§N</h2>
            <div class="section-line"></div>
          </div>
          <div id="eduRows" class="rows"></div>
        </section>

        <!-- KINH NGHI·ªÜM -->
        <section class="section">
          <div class="section-head">
            <h2 class="section-title">KINH NGHI·ªÜM L√ÄM VI·ªÜC</h2>
            <div class="section-line"></div>
          </div>
          <div id="expRows" class="rows"></div>
        </section>

        <!-- CH·ª®NG CH·ªà -->
        <section class="section">
          <div class="section-head">
            <h2 class="section-title">CH·ª®NG CH·ªà</h2>
            <div class="section-line"></div>
          </div>
          <div id="certList" class="plain-list"></div>
        </section>

        <!-- K·ª∏ NƒÇNG -->
        <section class="section">
          <div class="section-head">
            <h2 class="section-title">K·ª∏ NƒÇNG</h2>
            <div class="section-line"></div>
          </div>
          <div id="skillList" class="plain-list"></div>
        </section>
      </div>

      <!-- N√∫t g√≥c ph·∫£i (KH√îNG n·∫±m trong .cv) -->
      <div class="cv-actions no-print">
        <button
          class="icon-btn"
          type="button"
          title="In CV"
          aria-label="In CV"
          onclick="printPDF()"
        >
          üñ®Ô∏è
        </button>

        <button
          class="icon-btn"
          id="btnDownload"
          type="button"
          title="T·∫£i CV PDF"
          aria-label="T·∫£i CV PDF"
          onclick="downloadPDF()"
        >
          ‚¨áÔ∏è
        </button>
      </div>
    </main>

    <!-- html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- app.js: ƒë·ªï d·ªØ li·ªáu ƒë·ªông c·ªßa b·∫°n -->
    <script src="app.js"></script>

    <script>
      function printPDF() {
        setTimeout(() => window.print(), 50);
      }

      function waitForLayout() {
        return new Promise((resolve) =>
          requestAnimationFrame(() => requestAnimationFrame(resolve)),
        );
      }

      function waitForImages(root) {
        const imgs = Array.from(root.querySelectorAll("img"));
        return Promise.all(
          imgs.map(
            (img) =>
              new Promise((resolve) => {
                if (img.complete) return resolve();
                img.onload = () => resolve();
                img.onerror = () => resolve();
              }),
          ),
        );
      }

      async function downloadPDF() {
        const btn = document.getElementById("btnDownload");
        const oldText = btn ? btn.textContent : "‚¨áÔ∏è";

        try {
          if (!window.html2pdf) {
            alert("Thi·∫øu html2pdf");
            return;
          }

          if (btn) {
            btn.disabled = true;
            btn.textContent = "‚è≥";
          }

          // B·∫¨T EXPORT MODE (√©p A4 theo mm + ·∫©n n√∫t + t·∫Øt watermark)
          document.body.classList.add("export-mode");

          const cv = document.querySelector(".cv");

          await waitForLayout();
          if (document.fonts?.ready) await document.fonts.ready;
          await waitForImages(cv);
          await waitForLayout();

          const opt = {
            margin: 0,
            filename: "CV-Huynh-Thi-Kim-Han.pdf",
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: {
              scale: 2,
              useCORS: true,
              backgroundColor: "#fff",
              scrollX: 0,
              scrollY: 0,
            },
            jsPDF: {
              unit: "mm",
              format: "a4",
              orientation: "portrait",
            },
            pagebreak: { mode: ["css", "legacy"] },
          };

          await html2pdf().set(opt).from(cv).save();
        } catch (e) {
          console.error(e);
          alert("Xu·∫•t PDF l·ªói");
        } finally {
          document.body.classList.remove("export-mode");
          if (btn) {
            btn.disabled = false;
            btn.textContent = oldText;
          }
        }
      }
    </script>
  </body>
</html>
